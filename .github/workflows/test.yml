on:
  pull_request:
  push:
  release:
  workflow_dispatch:

jobs:
  send_message:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Check Env
        uses: actions/github-script@v6
        with:
          script: |
            console.log(`context: ${JSON.stringify(context, null, 4)}`);
            console.log(`core: ${JSON.stringify(core, null, 4)}`);

      - name: Set Env
        uses: actions/github-script@v6
        with:
          script: |
            let deployStage  = ''
            const eventName = context.eventName

            switch (eventName) {
              case 'push':
                deployStage = '${{ github.ref_name }}'
                break;
              case 'pull_request':
                deployStage = 'dev'
                break;
              case 'release':
                deployStage = context.payload.target_commitish
            }

            if (deployStage) {
              core.exportVariable('DEPLOY_STAGE', deployStage);
            }else{
              core.setFailed(`Can't set DEPLOY_STAGE`);
            }

      - name: test
        run: echo ${{ env.DEPLOY_STAGE }}
